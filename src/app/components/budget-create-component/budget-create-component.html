<div id="budget-create-component" style="display: none;">
  <div class="modal-overlay">
    <div class="modal-container">
      <!-- Header -->
      <div class="modal-header">
        <h2 class="modal-title">
          <i class="fas fa-file-invoice-dollar"></i>
          Crear Nueva Cotización
        </h2>
        <button class="close-btn" (click)="onCancel()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <!-- Content -->
      <div class="modal-content">
        <!-- Left Column -->
        <div class="left-column">
          <!-- Client Panel -->
          <div class="info-card client-card">
            <div class="card-header">
              <i class="fas fa-user"></i>
              <span>Cliente</span>
              <button class="change-btn" (click)="showClientSearch(true)">
                <i class="fas fa-edit"></i>
                Cambiar
              </button>
            </div>
            <div class="card-content">
              <div class="client-info">
                <h4 class="client-name">{{ this.propertiesQuotationService.client.name.toUpperCase() }} {{ this.propertiesQuotationService.client.lastName1.toUpperCase() }}</h4>
                <div class="client-details">
                  <span class="detail-item">
                    <i class="fas fa-id-card"></i>
                    CC. {{ this.propertiesQuotationService.client.pmsId }}
                  </span>
                  <span class="detail-item">
                    <i class="fas fa-envelope"></i>
                    {{ this.propertiesQuotationService.client.email }}
                  </span>
                </div>
              </div>
            </div>
          </div>   

          <!-- Property Panel -->
          <div class="info-card property-card">
            <div class="card-header">
              <i class="fas fa-home"></i>
              <span>Propiedad</span>
              <button class="change-btn" (click)="showPropertySearch(true)">
                <i class="fas fa-edit"></i>
                Cambiar
              </button>
            </div>
            <div class="card-content">
              <div class="property-info">
                <h4 class="property-code">{{ this.propertiesQuotationService.property.code?.toUpperCase() }}</h4>
                <div class="property-details">
                  <span class="detail-item">
                    <i class="fas fa-ruler-combined"></i>
                    Área: {{ this.propertiesQuotationService.property.area }} m²
                  </span>
                  <span class="detail-item">
                    <i class="fas fa-dollar-sign"></i>
                    Valor: ${{ this.propertiesQuotationService.property.amount | number: '1.0-0' }}
                  </span>
                </div>
              </div>
            </div>
          </div>


          <!-- Agent Panel -->
          <div class="info-card agent-card">
            <div class="card-header">
              <i class="fas fa-user-tie"></i>
              <span>Asesor</span>
              <button class="change-btn" (click)="showAgentSearch(true)">
                <i class="fas fa-edit"></i>
                Cambiar
              </button>
            </div>
            <div class="card-content">
              <div class="agent-info">
                <h4 class="agent-name">{{ this.propertiesQuotationService.agent.name }} {{ this.propertiesQuotationService.agent.lastName1 }} {{ this.propertiesQuotationService.agent.lastName2 }}</h4>
                <div class="agent-details">
                  <span class="detail-item">
                    <i class="fas fa-id-badge"></i>
                    CC. {{ this.propertiesQuotationService.agent.pmsId }}
                  </span>
                  <span class="role-badge">
                    <i class="fas fa-briefcase"></i>
                    Asesor
                  </span>
                </div>
              </div>
            </div>
          </div>

          <div class="quote-card-container">
            <app-property-quote-card-component></app-property-quote-card-component>
          </div>
        </div>

        <!-- Middle Column -->
        <div class="middle-column">
          <div class="form-container">
            <app-property-quote-form-component></app-property-quote-form-component>
          </div>
        </div>

        <!-- Right Column -->
        <div class="right-column">
          <div class="quotas-section">
            <div class="section-header">
              <i class="fas fa-calculator"></i>
              <h3>Plan de Pagos</h3>
            </div>
            
            <div class="quotas-table">
              <div class="table-header">
                <div class="header-cell number">#</div>
                <div class="header-cell concept">Concepto</div>
                <div class="header-cell date">Fecha</div>
                <div class="header-cell amount">Valor</div>
              </div>
              
              <div class="table-content">
                @for(quota of this.propertiesQuotationService.quotas; track $index) {
                  @if(quota.dueDate) {
                    <div class="table-row">
                      <div class="table-cell number">{{quota.number}}</div>
                      <div class="table-cell concept">{{quota.type}}</div>
                      <div class="table-cell date">{{ quota.dueDate | date: 'dd/MM/yyyy' }}</div>
                      <div class="table-cell amount">${{quota.amount | number : '1.0-0' : 'en-US'}}</div>
                    </div>
                  }
                }
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button class="btn-secondary" (click)="onCancel()">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        <button class="btn-primary" (click)="onSend()">
          <i class="fas fa-save"></i>
          Guardar Cotización
        </button>
      </div>
    </div>
  </div>
</div>

<app-client-search-component (selectAction)="selectClient($event)" (cancelAction)="cancelSearchClient()"></app-client-search-component>
<app-property-search-component (selectAction)="selectProperty($event)" (cancelAction)="cancelSearchProperty()"></app-property-search-component>
<app-agent-search-component (selectAction)="selectAgent($event)" (cancelAction)="cancelSearchAgent()"></app-agent-search-component>
<app-budget-send-form-component (finishedAction)="sendSuccessfully()"></app-budget-send-form-component>
<app-client-create-component  (clientCreatedAction)="clientCreated($event)"></app-client-create-component>
<app-property-create-component (propertyCreatedAction)="propertyCreated($event)"></app-property-create-component>