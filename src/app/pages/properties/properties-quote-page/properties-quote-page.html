<div class="main-container">

    <div class="button" style="position: absolute; top: 30px; right: 20px; z-index: 100;">
        <!--<a href="#">Crear nueva</a>-->
    </div>

    <br>
    <div style="position: absolute; top: 20px; left: 20px; z-index: 100;" >
        <input type="text" id="i_search_customer" name="i_search_customer" class="form-control" (keydown)="onKeydownClient($event)" placeholder="Buscar cliente por cédula" class="input-field" style="width: 270px;" />
    </div>

    <div id="panel-client-empty" style="position: absolute; top: 80px; left: 20px; z-index: 100; max-height: calc(100% - 200px); background-color: #f3f3f3; min-width: 280px; border-radius: 10px; padding: 20px; border: 1px solid #d8dcdd; color: #444444; display:none;" >
        <div align="center">
            <br>
            <div><b>CLIENTE NO ENCONTRADO</b></div>
            <br>
            <div>¿Deseas crearlo?</div>
            <br><br>
            <div class="button">
                <a routerLink="/clients/create">Crear Cliente</a>
            </div>
            <br>
        </div>
    </div>

    <div id="panel-client-name" style="position: absolute; top: 80px; left: 20px; z-index: 100; max-height: calc(100% - 200px); background-color: #f3f3f3; min-width: 280px; border-radius: 10px; padding: 20px; border: 0.7px solid gainsboro; color: #444444; display:none;" >
        <div align="left">
            <div style="display: flex; align-items: center; background-color: #f3f3f3; padding-right: 20px; border-radius: 40px;" class="project-card">
                <img src="imgs/img_client_empty.jpeg" style="width: 50px; height: 50px; object-fit: cover; border-radius: 100px; margin-right: 10px;">
                <div>
                    <div id="project-title"  style="font-size: 14px;"><i class="fa fa-user" style="font-size: 12px;"></i>&nbsp;{{ this.propertyQuoteService.client.name.toUpperCase() }}&nbsp;{{ this.propertyQuoteService.client.lastName1.toUpperCase() }}</div>
                    <div id="project-location" style="font-size: 14px; margin-top: 4px; color: var(--gray);"><i class="fa fa-envelope" style="font-size: 12px;"></i>&nbsp;{{ this.propertyQuoteService.client.email }}</div>
                    <div id="project-location" style="font-size: 14px; margin-top: 4px; color: var(--gray);"><i class="fa fa-phone" style="font-size: 12px;"></i>&nbsp;{{ this.propertyQuoteService.client.phone }}</div>
                </div>
            </div>
        </div>
    </div>

    <div id="panel-property-search" style="display: block;">
        <div id="panel-input-search" style="position: absolute; top: 20px; left: 400px; z-index: 100;" >
            <input type="text" id="i_search_property" name="i_search_property" class="form-control" (keyup)="onKeyUpProperty($event)" placeholder="Buscar propiedad:" class="input-search" style="width: 200px;">
        </div>

        <div id="panel-properties" style="position: absolute; top: 80px; left: 400px; z-index: 100;  max-height: calc(100% - 110px); overflow-y: auto; min-width: 320px; border-radius: 10px; padding: 0px;" >
            @for(p of this.propertyService.properties; track $index)
            {
                <app-property-card-component [property]="p" (click)="onPropertyClick(p)"></app-property-card-component>
            }
        </div>
    </div>

    <div id="panel-quote" style="display: none;">
        <div id="panel-property-info" style="position: absolute; padding: 10px; top: 20px; left: 400px; z-index: 100; background-color: #f3f3f3; overflow-y: auto; width: 320px; height: 45px; border-radius: 10px; border: 0.7px solid gainsboro; display:block;" >
            <div style="margin-bottom: 10px; position: absolute; color: var(--color-a); font-size: 20px; font-weight: bold; margin-bottom: 5px;">
                {{this.propertyQuoteService.property.code}}
            </div>
            <div id="property-area" style="font-size: 14px; margin-bottom: 10px; position: absolute; top: 37px; left: 10px;">Área:&nbsp;{{this.propertyQuoteService.property.area}}m2</div>

            <div id="property-area" style="font-size: 14px; margin-bottom: 10px; position: absolute; top: 15px; right: 10px;">Valor m2:&nbsp;${{this.propertyQuoteService.project.meterValue| number : '1.0-0' : 'en-US'}}</div>
            <div style="margin-bottom: 10px; position: absolute; color: var(--color-a); font-size: 15px; margin-bottom: 5px; top: 37px; right: 10px;">
                Valor total:&nbsp;&nbsp;<b>${{this.propertyQuoteService.property.amount | number : '1.0-0' : 'en-US'}}</b>
            </div>
        </div>

        <div style="position: absolute; padding: 10px; top: 25px; left: 740px; z-index: 100;" class="button-circle">
            <a (click)="onCloseQuotePanel()" title="Cerrar panel de cotización" style="width: 35px; height: 35px;"><p class='span-icon'><span class="fa-regular fa-xmark"></span></p></a>
        </div>

        <div id="panel-separation" style="position: absolute; top: 100px; left: 400px; z-index: 100; max-height: calc(100% - 140px); background-color: #f3f3f3; overflow-y: auto; width: 360px; border-radius: 10px; border: 0.7px solid gainsboro; padding: 0px; display:block; padding: 10px;" >
            <form [formGroup]="separationForm" style="width: 90%; max-width: 300px;" autocomplete="off">
                <div style="border-bottom: 1px solid #d8dcdd; color: #444444; padding-left: 10px; padding-right: 10px;">
                    <div class="field-row">
                        <label for="iSeparationQuota">Cuota de separación</label>
                        <input style="margin-top: 3px; width: 150px;" type="number" id="iSeparationQuota" (keyup)="process()" name="iSeparationQuota" required formControlName="separationQuota" class="input-field">
                    </div>
                </div>
                
                <br>
                <div style="border-bottom: 1px solid #d8dcdd; color: #444444; padding-left: 10px; padding-right: 10px;">
                    <div class="flex-container-flat">

                        <div class="field-row">
                            <label for="iInitialNumberOfQuotas">% C. Inicial</label>
                            <input style="margin-top: 3px; width: 100px;"  type="number" (keyup)="process()" id="iInitialPercent" name="iInitialPercent" formControlName="initialPercent" required  class="input-field">
                        </div>
                        &nbsp;&nbsp;&nbsp;
                        <div class="field-row">
                            <label for="iInitialBalance">Saldo c. inicial</label>
                            <input style="margin-top: 3px; width: 150px;" type="number" id="iInitialBalance" name="iInitialBalance" required readonly="true" formControlName="initialBalance" class="input-field">
                        </div>
                        

                    </div>

                    <div class="flex-container-flat">
                        <div class="field-row">
                            <label for="iInitialNumberOfQuotas"># de cuotas</label>
                            <input style="margin-top: 3px; width: 100px;" type="number" (keyup)="process()" id="iInitialNumberOfQuotas" name="iInitialNumberOfQuotas" required formControlName="initialNumberOfQuotas" class="input-field">
                        </div>
                        &nbsp;&nbsp;&nbsp;
                        <div class="field-row">
                            <label for="iInitialQuota">Valor cuota</label>
                            <input style="margin-top: 3px; width: 150px;" type="number" id="iInitialQuota" readonly="true" name="iInitialQuota" required formControlName="initialQuota" class="input-field">
                        </div>
                    </div>

                    <div class="flex-container-flat">
                        <div class="field-row">
                            <label for="iFinalBalance">Saldo final</label>
                            <input style="margin-top: 3px; width: 150px;" type="number" id="iFinalBalance" readonly="true" name="iFinalBalance" required formControlName="finalBalance" class="input-field">
                        </div>
                    </div>
                </div>

                <br>
                <div style="border-bottom: 1px solid #d8dcdd; color: #444444; padding-left: 10px; padding-right: 10px;">
                    <label for="iFinalBalance"><b>Cuotas ordinarias</b></label>
                    <br><br>
                    <div class="flex-container-flat">
                        <div class="field-row">
                            <label for="iFinalNumberOfQuotas"># de cuotas</label>
                            <input style="margin-top: 3px; width: 100px;" type="number" (keyup)="process()" id="iFinalNumberOfQuotas" name="iFinalNumberOfQuotas" required formControlName="finalNumberOfQuotas" class="input-field">
                        </div>
                        &nbsp;&nbsp;&nbsp;
                        <div class="field-row">
                            <label for="iFinalQuota">Valor cuota</label>
                            <input style="margin-top: 3px; width: 150px;" type="number" id="iFinalQuota" readonly="true" name="iFinalQuota" required formControlName="finalQuota" class="input-field">
                        </div>
                    </div>
                </div>

                <div style="border-bottom: 1px solid #d8dcdd; color: #444444; padding-left: 10px; padding-right: 10px; display: none;">
                    <br>
                    <label for="iFinalBalance"><b>Extras #1</b></label>
                    <br><br>
                    <div class="flex-container-flat">
                        <div class="field-row">
                            <label for="iFinalNumberOfQuotas"># de cuotas E1</label>
                            <input style="margin-top: 3px; width: 100px;" type="number" (keyup)="process()" id="iFinalNumberOfQuotasE1" name="iFinalNumberOfQuotasE1" class="input-field">
                        </div>
                        &nbsp;&nbsp;&nbsp;
                        <div class="field-row">
                            <label for="iFinalQuota">Valor cuota E1</label>
                            <input style="margin-top: 3px; width: 150px;" type="number" id="iQuotaE1" name="iQuotaE1" required class="input-field">
                        </div>
                    </div>

                    <div class="flex-container-flat">
                        <div class="field-row">
                            <label for="iFinalNumberOfQuotas">Subtotal Extras 1</label>
                            <input style="margin-top: 3px; width: 150px;" type="number" (keyup)="process()" id="iSubtotalE1" name="iSubtotalE1" readonly="true" class="input-field">
                        </div>
                    </div>
                </div>
                <br>
                <div style="border-bottom: 1px solid #d8dcdd; color: #444444; padding-left: 10px; padding-right: 10px;">
                    <div class="field-row">
                        <label for="iAgent">Asesor comercial *</label>
                        <div style="display: flex; align-items: center; margin-left:0px;" >
                            <select type="text" id="s_agent" name="s_agent" class="form-control" required placeholder="Buscar:" class="select-search" style="margin-left: 0px; width: 300px; font-size: 14px;" formControlName="agentId">
                                <option value="">Seleccione un asesor</option>
                                
                                @for(agent of agentService.agents; track $index) {
                                    <option value="{{agent.objectId}}">{{agent.name}} {{agent.lastName1}}</option>
                                }
                                
                            </select>

                            <button style="background: none; border: none; cursor: pointer; margin-left: -30px;" class="b_icon">
                                <i class="fas fa-angle-down"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </form>

            <div class="button" id='bt_quote' style="display: block; margin-top: 40px; margin-bottom: 30px;" align="center">
            <a (click)="generateQuotas()" >Continuar&nbsp;&nbsp;&nbsp;<i class="fa-solid fa-arrow-right"></i></a>
            </div>   
        </div>

    </div><!--fin panel quote-->

    <!-- Panel Cuotas -->
    <div id="panel-quotas">
        <div style="position: absolute; left: 840px; top: 20px; z-index: 100; background-color: #ffffff; overflow-y: auto; width: 360px; border-radius: 10px; border: 0.7px solid gainsboro; height: calc(100% - 50px);">
            <div class="row-header">
                <div class="col" style="max-width: 30px;" align="right"></div>
                <div class="col" style="max-width: auto;">Concepto</div>
                <div class="col" style="max-width: 80px;">Fecha</div>
                <div class="col" style="max-width: 80px;" align="right">Valor</div>
            </div>

            @for(quota of this.propertyQuoteService.quotas; track $index)
            {
                <div class="row">
                    <div class="col" style="max-width: 30px;" align="center">{{quota.number}}</div>
                    <div class="col" style="max-width: auto;">{{quota.type}}</div>
                    <div class="col" style="max-width: 80px;">{{ quota.dueDate | date: 'dd/MM/yyyy' }}</div>
                    <div class="col" style="max-width: 80px;" align="right">${{quota.amount | number : '1.0-0' : 'en-US'}}</div>
                </div>
            }

            <!--
            <div class="row">
                <div class="col" style="max-width: 30px;" align="right">1</div>
                <div class="col" style="max-width: auto;">Separación</div>
                <div class="col" style="max-width: 70px;">2025/03/13</div>
                <div class="col" style="max-width: 80px;" align="right">2.000.000</div>
            </div>
            -->

            <div class="button" id='bt_submit' style="display: block;  margin-top: 40px; margin-bottom: 40px;" align="center">
            <a (click)="submit()" >Registrar&nbsp;&nbsp;&nbsp;<i class="fa-solid fa-check"></i></a>
            </div> 
        </div>
    </div>

</div>

<app-menu-component></app-menu-component>
<app-project-selector-component></app-project-selector-component>
<app-loader-component></app-loader-component>