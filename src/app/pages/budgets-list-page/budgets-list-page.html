<div class="main-container modern-layout">
  <!-- Page Header -->
  <div class="page-header">
    <!-- Search and Filters -->
    <div class="search-filters">
      <div class="search-group">
        <i class="fas fa-search search-icon"></i>
        <input 
          type="text" 
          id="i_search" 
          name="i_search" 
          class="search-input" 
          (keyup)="onKeyup($event)" 
          placeholder="Buscar cotizaciones..." 
          autocomplete="off">
      </div>

      <div class="filter-group">
        <select 
          id="s_status" 
          name="s_status" 
          class="filter-select" 
          (change)="onChangeStatus($event)">
          <option value="na">Buscar por</option>
          <option value="property">Lote</option>
          <option value="cc">Cédula</option>
          <option value="lastname">Apellido</option>
        </select>
      </div>

      <div class="date-range-group">
        <mat-form-field (click)="picker3.open()" class="date-range-field">
          <mat-date-range-input [rangePicker]="picker3" [formGroup]="range">
            <input matStartDate placeholder="Desde" formControlName="start" readonly required>
            <input matEndDate placeholder="Hasta" formControlName="end" readonly required>
          </mat-date-range-input>
          <mat-date-range-picker #picker3></mat-date-range-picker>
        </mat-form-field>
        <button class="date-picker-button" (click)="picker3.open()">
          <i class="far fa-calendar-alt"></i>
        </button>
      </div>

      <button class="search-button" (click)="download()">
        <i class="fas fa-search"></i>
        Buscar
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button class="btn-primary" (click)="showCreateBudget(true)">
        <i class="fas fa-plus"></i>
        Crear nueva
      </button>
      <button class="btn-secondary" (click)="download()">
        <i class="fas fa-sync-alt"></i>
      </button>
    </div>
  </div>

  <!-- Budgets List -->
  <div class="budgets-list">
    <!-- List Header -->
    <div class="list-header">
      <div class="header-cell header-icon"></div>
      <div class="header-cell header-code"># Lote</div>
      <div class="header-cell header-date">Fecha</div>
      <div class="header-cell header-id">Cédula</div>
      <div class="header-cell header-client">Cliente</div>
      <div class="header-cell header-value">Valor</div>
      <div class="header-cell header-agent">Asesor</div>
      <div class="header-cell header-phase">Fase</div>
      <div class="header-cell header-actions">Acciones</div>
    </div>

    <!-- List Content -->
    <div class="list-content">
      @for (item of this.salesService.sales; track $index) {
        <div class="budget-item" (click)="onClickRow(item)">
          <div class="item-cell cell-icon">
            <i class="fas fa-file-invoice-dollar"></i>
          </div>
          <div class="item-cell cell-code">
            <span class="code-text">{{item.property.code}}</span>
          </div>
          <div class="item-cell cell-date">
            <span class="date-text">{{convertTimeToLocal(item.createdAt)}}</span>
          </div>
          <div class="item-cell cell-id">
            <span class="id-text">{{item.client.pmsId}}</span>
          </div>
          <div class="item-cell cell-client">
            <div class="client-info">
              <span class="client-name">{{item.client.name}} {{item.client.lastName1}}</span>
            </div>
          </div>
          <div class="item-cell cell-value">
            <span class="value-amount">${{item.amount | number: '1.0-0'}}</span>
          </div>
          <div class="item-cell cell-agent">
            <span class="agent-name">{{item.agent.name}} {{item.agent.lastName1}}</span>
          </div>
          <div class="item-cell cell-phase">
            <span class="phase-text">{{item.phase}}</span>
          </div>
          <div class="item-cell cell-actions">
            <div class="action-buttons-group">
              <button class="action-btn download-btn" (click)="onClickButton(item, 'download')" matTooltip="Descargar">
                <i class="fas fa-download"></i>
              </button>
              <button class="action-btn print-btn" (click)="onClickButton(item, 'print')" matTooltip="Imprimir">
                <i class="fas fa-print"></i>
              </button>
              <button class="action-btn whatsapp-btn" (click)="onClickButton(item, 'whatsapp')" matTooltip="Enviar por WhatsApp">
                <i class="fab fa-whatsapp"></i>
              </button>
              <button class="action-btn email-btn" (click)="onClickButton(item, 'email')" matTooltip="Enviar por correo">
                <i class="fas fa-envelope"></i>
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</div>

<app-user-profile-component></app-user-profile-component>
<app-menu-component></app-menu-component>
<app-project-selector-component></app-project-selector-component>
<app-budget-create-component (sendSuccessfullyAction)="createSaleSuccessfully()"></app-budget-create-component>
<app-loader-component></app-loader-component>